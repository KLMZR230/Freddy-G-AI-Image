<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freddy G Generador de Im√°genes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192x192.png">
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .glass-effect {
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .loader { border: 4px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-white">

    <main class="min-h-screen flex flex-col items-center justify-center p-4">
        
        <div class="w-full max-w-2xl text-center glass-effect rounded-2xl p-6 md:p-8">
            <h1 class="text-3xl md:text-5xl font-bold mb-2">Generador de Im√°genes</h1>
            <p class="text-lg mb-6 opacity-80">Da vida a tus ideas con IA</p>
            
            <form id="imageGenerationForm" class="w-full">
                <textarea id="promptInput" rows="3" class="w-full p-4 text-base bg-black bg-opacity-20 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:outline-none placeholder-white/60 resize-none" placeholder="Describe la imagen que quieres crear..."></textarea>
                
                <div id="style-buttons" class="flex flex-wrap gap-2 justify-center mt-4">
                    <button type="button" class="style-btn bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full text-sm transition-colors">Fotorrealista</button>
                    <button type="button" class="style-btn bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full text-sm transition-colors">Anime</button>
                    <button type="button" class="style-btn bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full text-sm transition-colors">Arte Fant√°stico</button>
                    <button type="button" class="style-btn bg-white/10 hover:bg-white/20 px-3 py-1 rounded-full text-sm transition-colors">Cyberpunk</button>
                </div>

                <div class="flex flex-col sm:flex-row gap-3 mt-6">
                    <button type="submit" id="generateBtn" class="w-full px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition-colors disabled:bg-gray-400 disabled:text-gray-800">Generar</button>
                    <button type="button" id="surpriseBtn" class="w-full sm:w-auto px-6 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition-colors flex-shrink-0">Sorpr√©ndeme ‚ú®</button>
                </div>
            </form>
        </div>

        <div id="loadingIndicator" class="text-center my-8 hidden">
             <div class="mx-auto loader"></div>
             <p class="mt-4 font-medium">Creando tu obra maestra...</p>
        </div>

        <div id="imageGallery" class="mt-8 w-full max-w-md">
            <!-- La imagen generada aparecer√° aqu√≠ -->
        </div>

        <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 hidden">
            <div class="glass-effect rounded-lg p-6 max-w-sm w-full text-center">
                <h3 id="modalTitle" class="text-lg font-bold mb-2"></h3>
                <p id="modalMessage" class="mb-4"></p>
                <button id="modalCloseBtn" class="px-4 py-2 bg-white text-black rounded-md">Entendido</button>
            </div>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('imageGenerationForm');
        const promptInput = document.getElementById('promptInput');
        const generateBtn = document.getElementById('generateBtn');
        const surpriseBtn = document.getElementById('surpriseBtn');
        const gallery = document.getElementById('imageGallery');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const modal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const styleButtonsContainer = document.getElementById('style-buttons');

        const randomPrompts = [
            "Un astronauta meditando en un jard√≠n zen en Marte, arte digital.",
            "Un zorro con atuendo de detective en una calle lluviosa de Londres, estilo noir.",
            "Un castillo flotante en el cielo al atardecer, rodeado de cascadas, arte fant√°stico.",
            "Una biblioteca m√°gica dentro de un √°rbol gigante, llena de luz.",
            "Un robot sirviendo t√© a un gato en un caf√© de estilo victoriano, fotorrealista.",
            "Una ciudad cyberpunk bajo una lluvia de ne√≥n, con coches voladores.",
            "Un drag√≥n hecho de cristal durmiendo en un campo de flores de loto luminosas."
        ];

        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
        }

        modalCloseBtn.addEventListener('click', () => modal.classList.add('hidden'));

        async function generateImage(prompt) {
            if (!prompt) {
                showModal('Error', 'Por favor, escribe un prompt.');
                return;
            }

            generateBtn.disabled = true;
            surpriseBtn.disabled = true;
            generateBtn.textContent = 'Generando...';
            loadingIndicator.classList.remove('hidden');
            gallery.innerHTML = '';

            try {
                const response = await fetch('/.netlify/functions/generate-image', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });

                if (!response.ok) {
                    let errorMsg = 'Hubo un error en el servidor.';
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.error || errorMsg;
                    } catch {
                        errorMsg = await response.text();
                    }
                    throw new Error(errorMsg);
                }
                
                const { imageUrl } = await response.json();
                addImageToGallery(imageUrl, prompt);

            } catch (error) {
                console.error('Error:', error);
                showModal('¬°Oops! Algo sali√≥ mal', error.message);
            } finally {
                generateBtn.disabled = false;
                surpriseBtn.disabled = false;
                generateBtn.textContent = 'Generar';
                loadingIndicator.classList.add('hidden');
            }
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const prompt = promptInput.value.trim();
            generateImage(prompt);
        });

        surpriseBtn.addEventListener('click', () => {
            const randomPrompt = randomPrompts[Math.floor(Math.random() * randomPrompts.length)];
            promptInput.value = randomPrompt;
            generateImage(randomPrompt);
        });

        styleButtonsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('style-btn')) {
                const style = e.target.textContent;
                const separator = promptInput.value.trim() === '' ? '' : ', ';
                promptInput.value += `${separator}${style}, alta definici√≥n`;
                promptInput.focus();
            }
        });

        function addImageToGallery(imageUrl, prompt) {
            const card = document.createElement('div');
            card.className = 'fade-in glass-effect rounded-xl shadow-lg overflow-hidden p-2 flex flex-col items-center';
            card.innerHTML = `
                <img src="${imageUrl}" alt="${prompt}" class="w-full h-auto object-cover rounded-lg mb-3">
                <a href="${imageUrl}" download="imagen-generada.png" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold transition-colors">
                    Descargar üì•
                </a>
            `;
            gallery.prepend(card);
        }
    });
    </script>
</body>
</html>
